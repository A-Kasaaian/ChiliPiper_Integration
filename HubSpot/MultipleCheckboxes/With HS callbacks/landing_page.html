<!-- Replace your current hubspot embed form code with the below, replacing the portalId and formId from your account -->
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script> 
<![endif]--> <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
<script src="https://js.chilipiper.com/marketing.js" type="text/javascript"></script>
<script>
  const hsPortalID = "[[hs_portal_id]]"; // REPLACE
  const hsFormID = "[[hs_form_id]]"; // REPLACE
  const cpTenantDomain = "[[cp_domain]]"; // REPLACE
  const cpRouterName = "[[cp_router]]"; // REPLACE
  //
  // No changes needed from this point
  //
  function handlerSubmit(elements) {
    var leadObj = {};
    // Validate required form input values
    for (var i = 0, element; (element = elements[i++]); ) {
      if (leadObj[element.name]) {
        leadObj[element.name] = leadObj[element.name] + ";" + element.value;
      } else {
        leadObj[element.name] = element.value;
      }
    }
    return leadObj;
  }
  hbspt.forms.create({
    portalId: hsPortalID,
    formId: hsFormID,
    onFormSubmit: function ($form) {
      var data = handlerSubmit($form.serializeArray());
      console.log(data);
      ChiliPiper.submit(cpTenantDomain, cpRouterName, {
        map: true,
        lead: data,
      });
    },
  });
</script>
